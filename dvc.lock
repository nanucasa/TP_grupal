schema: '2.0'
stages:
  data_prep:
    cmd: python src\data_prep.py --input data\raw\telco_churn.csv --outdir 
      data\processed --seed 42 --test-size 0.2 --val-size 0.1
    deps:
    - path: data/raw/telco_churn.csv
      hash: md5
      md5: 25e331349d6fc3e8608b1deaf35f4c71
      size: 882933
    - path: src/data_prep.py
      hash: md5
      md5: aefaa2cac76a71bb4f666e6c300b1912
      size: 4989
    outs:
    - path: data/processed
      hash: md5
      md5: 614060690e60b1ab4f301e442dd7136f.dir
      size: 1023708
      nfiles: 4
  train:
    cmd: python src\train.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --out-model models\model.joblib --metrics 
      metrics.json --best-params artifacts\best_params.json --params params.yaml
    deps:
    - path: artifacts/best_params.json
      hash: md5
      md5: d20390841c946883c84aef457b51248d
      size: 37
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/train.py
      hash: md5
      md5: e03981025861372075c8d4a1cdfb8119
      size: 5472
    params:
      params.yaml:
        train.C: 10.0
        train.max_iter: 1000
        train.seed: 42
    outs:
    - path: metrics.json
      hash: md5
      md5: e304825870467993bc163fdd4a5a4c2b
      size: 223
    - path: models/model.joblib
      hash: md5
      md5: 704ee90e14fdb50cd5f13eab69e8fcf7
      size: 1921
  evaluate_test:
    cmd: python src\evaluate.py --test data\processed\test.csv --model 
      models\model.joblib --metrics-out metrics_test.json
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models/model.joblib
      hash: md5
      md5: 704ee90e14fdb50cd5f13eab69e8fcf7
      size: 1921
    - path: src/evaluate.py
      hash: md5
      md5: 682ce56ccf5862239c62c6ebc55c9dd9
      size: 2503
    outs:
    - path: metrics_test.json
      hash: md5
      md5: 071df9b5991e98dc27b376ca493d7ffd
      size: 243
  tune:
    cmd: python src\tune.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --params params.yaml --best-out 
      artifacts\best_params.json --metrics-out metrics_tune.json
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/tune.py
      hash: md5
      md5: 65bd773ec9bcf221a1d45e1f85c20601
      size: 3993
    params:
      params.yaml:
        train.C: 10.0
        train.max_iter: 1000
        train.seed: 42
    outs:
    - path: artifacts/best_params.json
      hash: md5
      md5: d20390841c946883c84aef457b51248d
      size: 37
    - path: metrics_tune.json
      hash: md5
      md5: 482ef6db59ad12ae96c5019582ff020a
      size: 119
  predict_test:
    cmd: python src\predict.py --input data\processed\test.csv --model 
      models\model.joblib --output predictions\preds_test.csv --threshold-file 
      artifacts\best_threshold.json
    deps:
    - path: artifacts\best_threshold.json
      hash: md5
      md5: 6e4d6bc56e8088e8163e7e8523ac780f
      size: 44
    - path: data\processed\test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models\model.joblib
      hash: md5
      md5: a7840a2b37e912b68871565b41bf4cf4
      size: 1886
    - path: src\predict.py
      hash: md5
      md5: bf82fc6f588df3798a3a63cb22be0654
      size: 2254
    outs:
    - path: predictions\preds_test.csv
      hash: md5
      md5: 2885377864edc5d23ab4dcba86a49484
      size: 44407
  threshold:
    cmd: python src\threshold.py --valid data\processed\valid.csv --model 
      models\model.joblib --out-json artifacts\best_threshold.json --metrics-out
      metrics_threshold.json --roc-out reports\roc_curve.png --pr-out 
      reports\pr_curve.png
    deps:
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: models/model.joblib
      hash: md5
      md5: 704ee90e14fdb50cd5f13eab69e8fcf7
      size: 1921
    - path: src/threshold.py
      hash: md5
      md5: 71e2e6bb6a7306312586cda7c1de76a4
      size: 4262
    outs:
    - path: artifacts/best_threshold.json
      hash: md5
      md5: ffe77e0869a421d4368205dbf57278b8
      size: 45
    - path: metrics_threshold.json
      hash: md5
      md5: 30a56a4e82f029f92d6f6e34bac7d66e
      size: 226
    - path: reports/pr_curve.png
      hash: md5
      md5: d54fa2ef7d33824637c7f2f9f7d15d8c
      size: 21406
    - path: reports/roc_curve.png
      hash: md5
      md5: 533e39cd614f80db3699f0ea0faa852f
      size: 21015
  tune_rf:
    cmd: python src\tune_rf.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --params params.yaml --best-out 
      artifacts\best_params_rf.json --metrics-out metrics_tune_rf.json
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/tune_rf.py
      hash: md5
      md5: 826db2dd7b03e243cc5ab8e7778686ff
      size: 3211
    outs:
    - path: artifacts/best_params_rf.json
      hash: md5
      md5: c71fa5d6dea7e9064e8986b26093b647
      size: 73
    - path: metrics_tune_rf.json
      hash: md5
      md5: c1cd69eb386aa85d8300b29595dfe95f
      size: 361
  train_rf:
    cmd: python src\train_rf.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --out-model models\model_rf.joblib --metrics 
      metrics_rf.json --best-params artifacts\best_params_rf.json --params 
      params.yaml
    deps:
    - path: artifacts/best_params_rf.json
      hash: md5
      md5: c71fa5d6dea7e9064e8986b26093b647
      size: 73
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/train_rf.py
      hash: md5
      md5: 5b33c7e164067f89cc28bb8f82bdeb76
      size: 4533
    params:
      params.yaml:
        train.seed: 42
    outs:
    - path: metrics_rf.json
      hash: md5
      md5: db1a437ed01b94c1b9d1e3dd744bec94
      size: 263
    - path: models/model_rf.joblib
      hash: md5
      md5: d9e1861e80bee5fe892daf8cb4d1ee4d
      size: 1576329
  evaluate_test_rf:
    cmd: python src\evaluate.py --test data\processed\test.csv --model 
      models\model_rf.joblib --metrics-out metrics_test_rf.json
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models/model_rf.joblib
      hash: md5
      md5: d9e1861e80bee5fe892daf8cb4d1ee4d
      size: 1576329
    - path: src/evaluate.py
      hash: md5
      md5: 682ce56ccf5862239c62c6ebc55c9dd9
      size: 2503
    outs:
    - path: metrics_test_rf.json
      hash: md5
      md5: 21b46a95c92c615f2e997a5e3a1ec6c3
      size: 241
  tune_xgb:
    cmd: python src\tune_xgb.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --params params.yaml --best-out 
      artifacts\best_params_xgb.json --metrics-out metrics_tune_xgb.json
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/tune_xgb.py
      hash: md5
      md5: 044e2f84f0326eb3c126937252450ef1
      size: 3088
    outs:
    - path: artifacts/best_params_xgb.json
      hash: md5
      md5: dd37a9c90aba97fd35efae4fa56d2a1f
      size: 237
    - path: metrics_tune_xgb.json
      hash: md5
      md5: 9aa6dbf48df165cc58cbcb3a7cf03443
      size: 322
  train_xgb:
    cmd: python src\train_xgb.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --out-model models\model_xgb.joblib --metrics 
      metrics_xgb.json --best-params artifacts\best_params_xgb.json --params 
      params.yaml
    deps:
    - path: artifacts/best_params_xgb.json
      hash: md5
      md5: dd37a9c90aba97fd35efae4fa56d2a1f
      size: 237
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/train_xgb.py
      hash: md5
      md5: adbd9987afbb3c968b531900dbefb147
      size: 3550
    params:
      params.yaml:
        train.seed: 42
    outs:
    - path: metrics_xgb.json
      hash: md5
      md5: 3ca7ecad3b238659e43b3b8f2b84d3dc
      size: 441
    - path: models/model_xgb.joblib
      hash: md5
      md5: af7ebc9e9ffe45488d6758ca63ea1078
      size: 500273
  threshold_xgb:
    cmd: python src\threshold.py --valid data\processed\valid.csv --model 
      models\model_xgb.joblib --out-json artifacts\best_threshold_xgb.json 
      --metrics-out metrics_threshold_xgb.json --roc-out 
      reports\roc_curve_xgb.png --pr-out reports\pr_curve_xgb.png
    deps:
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: models/model_xgb.joblib
      hash: md5
      md5: af7ebc9e9ffe45488d6758ca63ea1078
      size: 500273
    - path: src/threshold.py
      hash: md5
      md5: 71e2e6bb6a7306312586cda7c1de76a4
      size: 4262
    outs:
    - path: artifacts/best_threshold_xgb.json
      hash: md5
      md5: 545232af21c925a2cfb156ea68d09744
      size: 45
    - path: metrics_threshold_xgb.json
      hash: md5
      md5: 1de2bcd7d6e294b477c4a88515b0bd04
      size: 230
    - path: reports/pr_curve_xgb.png
      hash: md5
      md5: 67dbf786c4b377239b57f6f6063a91d1
      size: 20753
    - path: reports/roc_curve_xgb.png
      hash: md5
      md5: 4d70a552da6cceaeb332cc5ffcbe47cc
      size: 21029
  evaluate_test_xgb:
    cmd: python src/evaluate.py --test data/features/test_fe.csv --model 
      models/model_xgb.joblib --metrics-out metrics_test_xgb.json
    deps:
    - path: data/features/test_fe.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models/model_xgb.joblib
      hash: md5
      md5: af7ebc9e9ffe45488d6758ca63ea1078
      size: 500273
    - path: src/evaluate.py
      hash: md5
      md5: 682ce56ccf5862239c62c6ebc55c9dd9
      size: 2503
    outs:
    - path: metrics_test_xgb.json
      hash: md5
      md5: b8b95749a2265b85e78c97210fa317f6
      size: 242
  predict_test_xgb:
    cmd: python src\predict.py --input data\processed\test.csv --model 
      models\model_xgb.joblib --threshold-file artifacts\best_threshold_xgb.json
      --output predictions\preds_test_xgb.csv
    deps:
    - path: artifacts\best_threshold_xgb.json
      hash: md5
      md5: ca765217a488351d33127da20c96ab3c
      size: 44
    - path: data\processed\test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models\model_xgb.joblib
      hash: md5
      md5: d35a1a2e10a839c822d69cefde571a6a
      size: 353662
    - path: src\predict.py
      hash: md5
      md5: bf82fc6f588df3798a3a63cb22be0654
      size: 2254
    outs:
    - path: predictions\preds_test_xgb.csv
      hash: md5
      md5: 98245684b984935685ed89a3c55d0036
      size: 27413
  feature_eng:
    cmd: python src\feature_eng.py --train-in data\processed\train.csv 
      --valid-in data\processed\valid.csv --test-in data\processed\test.csv 
      --train-out data\features\train_fe.csv --valid-out 
      data\features\valid_fe.csv --test-out data\features\test_fe.csv
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: data/processed/train.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/processed/valid.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/feature_eng.py
      hash: md5
      md5: 679cf724db1dffbd0209409f97225244
      size: 1368
    outs:
    - path: data/features/test_fe.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: data/features/train_fe.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/features/valid_fe.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
  train_fe:
    cmd: python src\train.py --train data\features\train_fe.csv --valid 
      data\features\valid_fe.csv --out-model models\model_fe.joblib --metrics 
      metrics_fe.json --best-params artifacts\best_params.json --params 
      params.yaml
    deps:
    - path: artifacts/best_params.json
      hash: md5
      md5: d20390841c946883c84aef457b51248d
      size: 37
    - path: data/features/train_fe.csv
      hash: md5
      md5: 8f5c35515f9f2ed31d9555ba58b1579b
      size: 715729
    - path: data/features/valid_fe.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: src/train.py
      hash: md5
      md5: e03981025861372075c8d4a1cdfb8119
      size: 5472
    params:
      params.yaml:
        train.C: 10.0
        train.max_iter: 1000
        train.seed: 42
    outs:
    - path: metrics_fe.json
      hash: md5
      md5: e304825870467993bc163fdd4a5a4c2b
      size: 223
    - path: models/model_fe.joblib
      hash: md5
      md5: 704ee90e14fdb50cd5f13eab69e8fcf7
      size: 1921
  threshold_fe:
    cmd: python src\threshold.py --valid data\features\valid_fe.csv --model 
      models\model_fe.joblib --out-json artifacts\best_threshold_fe.json 
      --metrics-out metrics_threshold_fe.json --roc-out reports\roc_curve_fe.png
      --pr-out reports\pr_curve_fe.png
    deps:
    - path: data\features\valid_fe.csv
      hash: md5
      md5: d33f3c1653cac4c9d9cc14227f77ee79
      size: 102550
    - path: models\model_fe.joblib
      hash: md5
      md5: a7840a2b37e912b68871565b41bf4cf4
      size: 1886
    - path: src\threshold.py
      hash: md5
      md5: 71e2e6bb6a7306312586cda7c1de76a4
      size: 4262
    outs:
    - path: artifacts\best_threshold_fe.json
      hash: md5
      md5: 6e4d6bc56e8088e8163e7e8523ac780f
      size: 44
    - path: metrics_threshold_fe.json
      hash: md5
      md5: 30a56a4e82f029f92d6f6e34bac7d66e
      size: 226
    - path: reports\pr_curve_fe.png
      hash: md5
      md5: b1a9802df3b5c7c1cc2dcbe6794c4cf3
      size: 21428
    - path: reports\roc_curve_fe.png
      hash: md5
      md5: 335da4793b09a75a4ede833f9cf2ec6a
      size: 21047
  evaluate_test_fe:
    cmd: python src\evaluate.py --test data\features\test_fe.csv --model 
      models\model_fe.joblib --metrics-out metrics_test_fe.json
    deps:
    - path: data/features/test_fe.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models/model_fe.joblib
      hash: md5
      md5: 704ee90e14fdb50cd5f13eab69e8fcf7
      size: 1921
    - path: src/evaluate.py
      hash: md5
      md5: 682ce56ccf5862239c62c6ebc55c9dd9
      size: 2503
    outs:
    - path: metrics_test_fe.json
      hash: md5
      md5: 071df9b5991e98dc27b376ca493d7ffd
      size: 243
  select_register:
    cmd: python scripts\select_and_register.py --mlflow-uri 
      http://127.0.0.1:5001 --write-out artifacts\selection.json
    deps:
    - path: metrics_test.json
      hash: md5
      md5: 071df9b5991e98dc27b376ca493d7ffd
      size: 243
    - path: metrics_test_fe.json
      hash: md5
      md5: 071df9b5991e98dc27b376ca493d7ffd
      size: 243
    - path: metrics_test_rf.json
      hash: md5
      md5: 21b46a95c92c615f2e997a5e3a1ec6c3
      size: 241
    - path: metrics_test_xgb.json
      hash: md5
      md5: b8b95749a2265b85e78c97210fa317f6
      size: 242
    - path: scripts/select_and_register.py
      hash: md5
      md5: beb6dbf11532e0dfc862d7d8f75f6f23
      size: 4312
    outs:
    - path: artifacts/selection.json
      hash: md5
      md5: 19d24c1d16413aa623f27d26ca209ccd
      size: 1574
  predict_champion:
    cmd: python scripts\predict_champion.py --test data\processed\test.csv --out
      predictions\preds_test_champion.csv --mlflow-uri http://127.0.0.1:5001
    deps:
    - path: artifacts/selection.json
      hash: md5
      md5: 19d24c1d16413aa623f27d26ca209ccd
      size: 1574
    - path: data/processed/test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: scripts/predict_champion.py
      hash: md5
      md5: 834226dcf21b2b8d3e021eacc240bc24
      size: 5643
    outs:
    - path: predictions/preds_test_champion.csv
      hash: md5
      md5: 742447e073bbd2d89cca7219273ae663
      size: 6006
  predict_test_rf:
    cmd: python src\predict.py --input data\processed\test.csv --model 
      models\model_rf.joblib --output predictions\preds_test_rf.csv 
      --threshold-file artifacts\best_threshold.json
    deps:
    - path: artifacts\best_threshold.json
      hash: md5
      md5: 6e4d6bc56e8088e8163e7e8523ac780f
      size: 44
    - path: data\processed\test.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models\model_rf.joblib
      hash: md5
      md5: d9e1861e80bee5fe892daf8cb4d1ee4d
      size: 1576329
    - path: src\predict.py
      hash: md5
      md5: bf82fc6f588df3798a3a63cb22be0654
      size: 2254
    outs:
    - path: predictions\preds_test_rf.csv
      hash: md5
      md5: 65d86085d28ce9de49b2c20acca9cf92
      size: 44277
  predict_test_fe:
    cmd: python src\predict.py --input data\features\test_fe.csv --model 
      models\model_fe.joblib --output predictions\preds_test_fe.csv 
      --threshold-file artifacts\best_threshold_fe.json
    deps:
    - path: artifacts\best_threshold_fe.json
      hash: md5
      md5: 6e4d6bc56e8088e8163e7e8523ac780f
      size: 44
    - path: data\features\test_fe.csv
      hash: md5
      md5: 504c23a16229ee2680239bd7f5206d4c
      size: 204688
    - path: models\model_fe.joblib
      hash: md5
      md5: a7840a2b37e912b68871565b41bf4cf4
      size: 1886
    - path: src\predict.py
      hash: md5
      md5: bf82fc6f588df3798a3a63cb22be0654
      size: 2254
    outs:
    - path: predictions\preds_test_fe.csv
      hash: md5
      md5: 2885377864edc5d23ab4dcba86a49484
      size: 44407
  report_benchmark:
    cmd: python src\report_benchmark.py --sources metrics_test.json 
      metrics_test_rf.json metrics_test_xgb.json metrics_test_fe.json --out-md 
      reports/benchmark.md --out-fig reports/f1_bench.png
    deps:
    - path: metrics_test.json
      hash: md5
      md5: 071df9b5991e98dc27b376ca493d7ffd
      size: 243
    - path: metrics_test_fe.json
      hash: md5
      md5: 071df9b5991e98dc27b376ca493d7ffd
      size: 243
    - path: metrics_test_rf.json
      hash: md5
      md5: 21b46a95c92c615f2e997a5e3a1ec6c3
      size: 241
    - path: metrics_test_xgb.json
      hash: md5
      md5: b8b95749a2265b85e78c97210fa317f6
      size: 242
    - path: src/report_benchmark.py
      hash: md5
      md5: e5a8c37569627e37f50a4a33aaccf19b
      size: 3184
    outs:
    - path: reports/benchmark.md
      hash: md5
      md5: fafa3a9009385404eee7b15113dfa1d2
      size: 247
    - path: reports/f1_bench.png
      hash: md5
      md5: ca6dac58ae2aff3134fce061b992a86d
      size: 10979
  alias_champion:
    cmd: python scripts\alias_champion.py --mlflow-uri http://127.0.0.1:5001 
      --selection artifacts\selection.json --alias champion --write-out 
      artifacts\aliases_applied.json
    deps:
    - path: artifacts/selection.json
      hash: md5
      md5: 19d24c1d16413aa623f27d26ca209ccd
      size: 1574
    - path: scripts/alias_champion.py
      hash: md5
      md5: bd10bc869864903a7ba7ac2a1f4cd040
      size: 5444
    outs:
    - path: artifacts/aliases_applied.json
      hash: md5
      md5: 9aceaac64efc534a32fd2362e51f49fa
      size: 237
