stages:
  data_prep:
    cmd: python src\data_prep.py --input data\raw\telco_churn.csv --outdir 
      data\processed --seed 42 --test-size 0.2 --val-size 0.1
    deps:
    - data\raw\telco_churn.csv
    - src\data_prep.py
    outs:
    - data\processed
  train:
    cmd: python src\train.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --out-model models\model.joblib --metrics 
      metrics.json --best-params artifacts\best_params.json --params params.yaml
    deps:
    - artifacts\best_params.json
    - data\processed\train.csv
    - data\processed\valid.csv
    - src\train.py
    outs:
    - models\model.joblib
    metrics:
    - metrics.json:
        cache: false
    params:
    - train.C
    - train.max_iter
    - train.seed
  evaluate_test:
    cmd: python src\evaluate.py --test data\processed\test.csv --model 
      models\model.joblib --metrics-out metrics_test.json
    deps:
    - artifacts\best_threshold.json
    - data\processed\test.csv
    - models\model.joblib
    - src\evaluate.py
    metrics:
    - metrics_test.json:
        cache: false
  tune:
    cmd: python src\tune.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --params params.yaml --best-out 
      artifacts\best_params.json --metrics-out metrics_tune.json
    deps:
    - data\processed\train.csv
    - data\processed\valid.csv
    - params.yaml
    - src\tune.py
    metrics:
    - artifacts\best_params.json:
        cache: false
    - metrics_tune.json:
        cache: false
  predict_test:
    cmd: python src\predict.py --input data\processed\test.csv --model 
      models\model.joblib --output predictions\preds_test.csv
    deps:
    - artifacts\best_threshold.json
    - data\processed\test.csv
    - models\model.joblib
    - src\predict.py
    outs:
    - predictions\preds_test.csv
  threshold:
    cmd: python src\threshold.py --valid data\processed\valid.csv --model 
      models\model.joblib --out-json artifacts\best_threshold.json --metrics-out
      metrics_threshold.json --roc-out reports\roc_curve.png --pr-out 
      reports\pr_curve.png
    deps:
    - data\processed\valid.csv
    - models\model.joblib
    - src\threshold.py
    outs:
    - reports\pr_curve.png
    - reports\roc_curve.png
    metrics:
    - artifacts\best_threshold.json:
        cache: false
    - metrics_threshold.json:
        cache: false
  tune_rf:
    cmd: python src\tune_rf.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --params params.yaml --best-out 
      artifacts\best_params_rf.json --metrics-out metrics_tune_rf.json
    deps:
    - data\processed\train.csv
    - data\processed\valid.csv
    - params.yaml
    - src\tune_rf.py
    metrics:
    - artifacts\best_params_rf.json:
        cache: false
    - metrics_tune_rf.json:
        cache: false
  train_rf:
    cmd: python src\train_rf.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --out-model models\model_rf.joblib --metrics 
      metrics_rf.json --best-params artifacts\best_params_rf.json --params 
      params.yaml
    deps:
    - artifacts\best_params_rf.json
    - data\processed\train.csv
    - data\processed\valid.csv
    - params.yaml
    - src\train_rf.py
    outs:
    - models\model_rf.joblib
    metrics:
    - metrics_rf.json:
        cache: false
  evaluate_test_rf:
    cmd: python src\evaluate.py --test data\processed\test.csv --model 
      models\model_rf.joblib --metrics-out metrics_test_rf.json
    deps:
    - artifacts\best_threshold.json
    - data\processed\test.csv
    - models\model_rf.joblib
    - src\evaluate.py
    metrics:
    - metrics_test_rf.json:
        cache: false
  predict_test_rf:
    cmd: python src\predict.py --input data\processed\test.csv --model 
      models\model_rf.joblib --output predictions\preds_test_rf.csv
    deps:
    - artifacts\best_threshold.json
    - data\processed\test.csv
    - models\model_rf.joblib
    - src\predict.py
    outs:
    - predictions\preds_test_rf.csv
  tune_xgb:
    cmd: python src\tune_xgb.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --params params.yaml --best-out 
      artifacts\best_params_xgb.json --metrics-out metrics_tune_xgb.json
    deps:
    - data\processed\train.csv
    - data\processed\valid.csv
    - params.yaml
    - src\tune_xgb.py
    metrics:
    - artifacts\best_params_xgb.json:
        cache: false
    - metrics_tune_xgb.json:
        cache: false
  train_xgb:
    cmd: python src\train_xgb.py --train data\processed\train.csv --valid 
      data\processed\valid.csv --out-model models\model_xgb.joblib --metrics 
      metrics_xgb.json --best-params artifacts\best_params_xgb.json --params 
      params.yaml
    deps:
    - artifacts\best_params_xgb.json
    - data\processed\train.csv
    - data\processed\valid.csv
    - params.yaml
    - src\train_xgb.py
    outs:
    - models\model_xgb.joblib
    metrics:
    - metrics_xgb.json:
        cache: false
  threshold_xgb:
    cmd: python src\threshold.py --valid data\processed\valid.csv --model 
      models\model_xgb.joblib --out-json artifacts\best_threshold_xgb.json 
      --metrics-out metrics_threshold_xgb.json --roc-out 
      reports\roc_curve_xgb.png --pr-out reports\pr_curve_xgb.png
    deps:
    - data\processed\valid.csv
    - models\model_xgb.joblib
    - src\threshold.py
    outs:
    - reports\pr_curve_xgb.png
    - reports\roc_curve_xgb.png
    metrics:
    - artifacts\best_threshold_xgb.json:
        cache: false
    - metrics_threshold_xgb.json:
        cache: false
  evaluate_test_xgb:
    cmd: python src\evaluate.py --test data\processed\test.csv --model 
      models\model_xgb.joblib --threshold-file artifacts\best_threshold_xgb.json
      --metrics-out metrics_test_xgb.json
    deps:
    - artifacts\best_threshold_xgb.json
    - data\processed\test.csv
    - models\model_xgb.joblib
    - src\evaluate.py
    metrics:
    - metrics_test_xgb.json:
        cache: false
  predict_test_xgb:
    cmd: python src\predict.py --input data\processed\test.csv --model 
      models\model_xgb.joblib --threshold-file artifacts\best_threshold_xgb.json
      --output predictions\preds_test_xgb.csv
    deps:
    - artifacts\best_threshold_xgb.json
    - data\processed\test.csv
    - models\model_xgb.joblib
    - src\predict.py
    outs:
    - predictions\preds_test_xgb.csv
  report_benchmark:
    cmd: python src\report_benchmark.py
    deps:
    - metrics_test.json
    - metrics_test_rf.json
    - metrics_test_xgb.json
    - src\report_benchmark.py
    outs:
    - reports\benchmark.md
    - reports\f1_bench.png
  feature_eng:
    cmd: python src\feature_eng.py --train-in data\processed\train.csv 
      --valid-in data\processed\valid.csv --test-in data\processed\test.csv 
      --train-out data\features\train_fe.csv --valid-out 
      data\features\valid_fe.csv --test-out data\features\test_fe.csv
    deps:
    - data\processed\test.csv
    - data\processed\train.csv
    - data\processed\valid.csv
    - src\feature_eng.py
    outs:
    - data\features\test_fe.csv
    - data\features\train_fe.csv
    - data\features\valid_fe.csv
